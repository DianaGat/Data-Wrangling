---
title: "week_4"
author: "Diana Hilleshein"
date: "2/7/2022"
header-includes:
  \usepackage{fvextra}
  \DefineVerbatimEnvironment{Highlighting}{Verbatim}{breaklines,commandchars=\\\{\}}
output: pdf_document
---

## Testing  
```{r}
library(tidyverse)
test <- tribble(
  ~A, ~B,  ~C,
  10, 10, 10,
  10, 10, NA,
  10, NA, NA,
  NA, NA, NA
)

View(test)

# Create a new variable which is sum of variables A, B and C
test$sum1 <- test$A + test$B + test$C #<= [1:1] + [1:2] + [1:3] and so on
test$sum1 #if there is at least one NA, the addition result will be NA
test$sum2 <- rowSums(test[,1:3]) #[rows,cols]//[all_rows,from 1st to 3rd cols]
test$sum2 #same...

test$sum2 <- rowSums(test[,1:3], na.rm = TRUE)
test$sum2 #na.rm helped to escape NA and get summ of the rows (NA as 0)


test$mean1 <- (test$A + test$B + test$C)/3
test$mean1 #if there is at least one NA, the addition result will be NA

test$mean2 <- rowMeans(test[,1:3]) 
test$mean2 #same

test$mean2 <- rowMeans(test[,1:3], na.rm = TRUE) 
test$mean2 #na.rm helped to escape NA and get mean of the rows (taking NA as 0 the function cant give a result since 0 cant cant be divided)
```
## Create a sum variable.  

I will use the following variables:  
**Attitude to immigrants**
**4 levels**
1) **imsmetn** -Allow many/few immigrants of same race/ethnic group as majority (scale from 1 to 4, 1 = Allow many to come and live here, 4 = Allow none)  
2) **imdfetn** -Allow many/few immigrants of different race/ethnic group from majority (scale from 1 to 4, 1 = Allow many to come and live here, 4 = Allow none)  
3) **impcntr** -Allow many/few immigrants from poorer countries outside Europe (scale from 1 to 4, 1 = Allow many to come and live here, 4 = Allow none)  

```{r message=FALSE, warning=FALSE}
setwd("C:/R scripts/DWA2022")
library(haven)

# import data
data <- read_sav("C:/R scripts/DWA2022/ESS9e03_1.sav")

save(data,file="data.csv")
head(data)
dim(data)#everything is right
```

```{r}
table(data$imsmetn, useNA = "ifany")
table(data$imdfetn, useNA = "ifany")
table(data$impcntr, useNA = "ifany")
```
I found some documentation regarding useNA = "ifany" that I didnt know before: <https://stat.ethz.ch/R-manual/R-devel/library/base/html/table.html>. *"useNA controls if the table includes counts of NA values: the allowed values correspond to never ("no"), only if the count is positive ("ifany") and even for zero counts ("always")"*  

```{r message=FALSE, warning=FALSE}

library(summarytools)
library(sjlabelled)

freq(data$imsmetn)
freq(data$imdfetn)
freq(data$impcntr) 

library(dplyr)
library(ggplot2)
library(scales) 

#data %>% select(data, imsmetn, imdfetn, impcntr) %>% 
#  summarytools::freq()
```
The last two lines didn` work for me, the follwoing error message appeared: *"Error: Must subset columns with a valid subscript vector."* I faced this kind of mistke before and did not find a solution :(  

So I decided to do it another way:
```{r}
#sel_var <- select(data, imsmetn, imdfetn, impcntr)
which(colnames(data) == "imsmetn")
which(colnames(data) == "imdfetn")
which(colnames(data) == "impcntr")
freq(data[,109:111])
```
Well, for some reason this way worked! R can be unpredictable.  


Next, I will create a sum variable.
```{r}
data$sum <- rowSums(data[,109:111], na.rm = T)
head(data[,109:111], n = 25)
head(data$sum, n = 25)

which(colnames(data) == "sum")
```
The result from 24th row is 0, we can see that 24th row in the dataset has NA in all columns, therefore I get 0.  

Find mean:  
```{r}
data$avg <- rowMeans(data[,109:111], na.rm = T)
head(data[,109:111], n = 25)
head(data$avg, n = 25)

which(colnames(data) == "avg")
```
The 24th row does not have a result since 0 can not be devided.  

Incorrect versions:  
```{r}
data$wrong_sum <- data$imsmetn + data$imdfetn + data$impcntr
head(data$wrong_sum, n = 25)

data$wrong_avg <- (data$imsmetn + data$imdfetn + data$impcntr)/3
head(data$wrong_avg, n = 25)
```
Same situation with 24th row.  

### Calculate some descriptive statistics of your new sum variable and visualize it.  

```{r}
summary(data[,109:111])
summary(data[,573:574])

hist(data$sum)
hist(data$avg)
```
The majority of answers summarized fall on number 5 that I can interpret as above average. The majority of answers in plotted for average values fall on 2, that is again above average.  

### Use some sub-groups or domains in the data set (e.g. country, gender, agegroup, â€¦) and calculate some descriptive statistics of your new sum variable and visualize it by these sub-groups/domains.  

Before I start it is important to note that sum variable has values from 0 to 12 - from "Allow many to come" to "Allow none",  
```{r}
w4 <-select(data, cntry, agea, gndr, sum)
w4

females <- w4 %>% filter(gndr == 2)
males <- w4 %>% filter(gndr == 1)

summary(females)
summary(males)
```
The difference in sum value is not that big between men and women, therefore there is no a big difference between an attitude to immigrants between females and males.  


```{r}
mean(w4$agea, na.rm = T) #51 years is an average age
younger <- w4 %>% filter(agea < 51)
older <- w4 %>% filter(agea >= 51)

summary(younger)
summary(older)
```
There is no a significant difference between an attitude to immigrants between people who are younger or older that 51.  

```{r}
library(dplyr)
a1 <- w4 %>% group_by(cntry) %>% summarise(mean_sum = mean(sum, na.rm = TRUE)) 
a1

ggplot(a1, aes(x = cntry, y = mean_sum, fill = "dark orange", alpha = 0.8)) +
  geom_bar(stat="identity", position=position_dodge()) + ylab ("mean attitude towards immigrants") + xlab("country")
```
* AT = Austria, BE = Belgium, BG = Bulgaria, CH = Switzerland, CY = Cyprus,  CZ = Czechia, DE = Germany, DK = Denmark, EE = Estonia, ES = Spain, FI = Finland, FR = France, GB = United Kingdom, HR = Croatia, HU = Hungary, IE = Ireland, IS = Iceland, IT = Italy, LT = Lithuania,  LV = Latvia, ME = Montenegro, NL = Netherlands, NO = Norway, PL = Poland, PT = Portugal, RS = Serbia,  SE = Sweden, SI = Slovenia, SK = Slovakia  

The interpretation for results: 0 - Allow many to come and live here,... 12 - Allow none  

We can see that people in Hungary and Iceland have the lowest value (below 5) for mean attitude towards immigrants. I feel that results for hungaria may be unreliable knowing politics of Hungarian government. Majority of values fall between 5 and 7.