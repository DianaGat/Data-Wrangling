corrmatrix
corrmatrix <- cor(select(data7, img_avg, agea, gndr, polintr), use="complete.obs")
corrmatrix
library(corrplot)
corrplot(corrmatrix)
data7 <- data7 %>%
mutate(img_avg_cat = cut(img_avg, breaks = c(1,2,3,), labels = c("Allow many to come and live here","2", "3", "Allow none")))
data7 <- data7 %>%
mutate(img_avg_cat = cut(img_avg, breaks = c(1,2,3), labels = c("Allow many to come and live here","2", "3", "Allow none")))
data7 <- data7 %>%
mutate(img_avg_cat = cut(img_avg, breaks = c(0-1,1-2,2-3,3-4), labels = c("Allow many to come and live here","2", "3", "Allow none")))
data7 <- data7 %>%
mutate(img_avg_cat = cut(img_avg, breaks = c(1,1-2,2-3,3), labels = c("Allow many to come and live here","2", "3", "Allow none")))
data7 <- data7 %>%
mutate(img_avg_cat = cut(img_avg, breaks = c(0,1,2,3, Inf), labels = c("Allow many to come and live here","2", "3", "Allow none")))
data7
data7 %>% prop.table(img_avg, polintr) # sum of all values
t1 <- table(data7$img_avg_cat, data7$polintr)
t1
data7 %>% prop.table(t1) # sum of all values
prop.table(t1) # sum of all values
g1 <- ggplot(data = data7, aes(x = polintr, fill = factor(gndr))) + geom_bar()
g2 <- ggplot(data = data7, aes(x = agea, fill = factor(gndr))) + geom_histogram()
g3 <- ggplot(data = data7, aes(x = img_avg, fill = factor(gndr))) + geom_bar()
g4 <- ggplot(data = data7, aes(x = stflife, fill = factor(gndr))) + geom_bar()
g5 <- ggplot(data = data7, aes(x = gndr, fill = factor(gndr)))+ geom_bar()
library(cowplot)
plot_grid(
g1, g2, g3, g4, g5,
labels = c('1', '2', '3', '4', "5"),
align="hv"
)
data7 <- data %>% filter(cntry %in% cntry_target) %>%
select(., cntry, agea, gndr, img_avg, polintr, stflife)
data7 <- data7[complete.cases(data7[ ,c("cntry", "agea", "gndr", "img_avg", "polintr", "stflife")]), ]
summary(data7)
g1 <- ggplot(data = data7, aes(x = polintr, fill = factor(gndr))) + geom_bar()
g2 <- ggplot(data = data7, aes(x = agea, fill = factor(gndr))) + geom_histogram()
g3 <- ggplot(data = data7, aes(x = img_avg, fill = factor(gndr))) + geom_bar()
g4 <- ggplot(data = data7, aes(x = stflife, fill = factor(gndr))) + geom_bar()
g5 <- ggplot(data = data7, aes(x = gndr, fill = factor(gndr)))+ geom_bar()
library(cowplot)
plot_grid(
g1, g2, g3, g4, g5,
labels = c('1', '2', '3', '4', "5"),
align="hv"
)
g1 <- ggplot(data = data7, aes(x = polintr, fill = factor(gndr))) + geom_bar()
g2 <- ggplot(data = data7, aes(x = agea, fill = factor(gndr))) + geom_histogram()
g3 <- ggplot(data = data7, aes(x = img_avg, fill = factor(gndr))) + geom_bar()
g4 <- ggplot(data = data7, aes(x = stflife, fill = factor(gndr))) + geom_bar()
g5 <- ggplot(data = data7, aes(x = gndr, fill = factor(gndr)))+ geom_bar()
library(cowplot)
plot_grid(
g1, g2, g3, g4,
labels = c('1', '2', '3', '4'),
align="hv"
)
boxplot(select(data7, - cntry, -agea))
corrmatrix <- cor(select(data7, img_avg, agea, gndr, polintr, stflife), use="complete.obs")
corrmatrix
library(corrplot)
corrplot(corrmatrix)
data7 <- data7 %>%
mutate(img_avg_cat = cut(img_avg, breaks = c(0,1,2,3, Inf), labels = c("Allow many to come and live here","2", "3", "Allow none")))
t1 <- table(data7$img_avg_cat, data7$stflife)
prop.table(t1) # sum of all values
prop.table(t1, 1) # sum of all values
prop.table(t1)
prop.table(t1, 1) # sum of all values
data7
data$img_avg
View(data)
this <- select(data, imwbcnt, imbgeco, imueclt)
this
#create mean var
data$img_avg <- rowMeans(select(data, imsmetn , imdfetn , impcntr ), na.rm = TRUE)
data$img_avg
# set working directory
setwd("C:/R scripts/DWA2022")
#import data
library(haven) # to open csv
data <- read_sav("C:/R scripts/DWA2022/ESS9e03_1.sav")
head(data)
dim(data) #everything is right
# create a sum var, wxluding missing values
library(tidyverse)
library(dplyr)
#data$img_sum <- rowSums(select(data, imwbcnt, imbgeco, imueclt), na.rm = TRUE)
#head(data$img_avg)
#create mean var
data$img_avg <- rowMeans(select(data, imsmetn , imdfetn , impcntr ), na.rm = TRUE)
head(data$img_avg)
# select Finnish and Italian data
cntry_target <- c("EE", "LT", "LV")
data7 <- data %>% filter(cntry %in% cntry_target) %>%
select(., cntry, agea, gndr, img_avg, polintr, stflife)
data7 <- data7[complete.cases(data7[ ,c("cntry", "agea", "gndr", "img_avg", "polintr", "stflife")]), ]
summary(data7)
head(data7)
dim(data7) #looks right!
# histograms by groups for img_avg
ggplot(data7, aes(x = img_avg)) +
geom_histogram() + facet_grid(cntry ~ .)
# set working directory
setwd("C:/R scripts/DWA2022")
#import data
library(haven) # to open csv
data <- read_sav("C:/R scripts/DWA2022/ESS9e03_1.sav")
head(data)
dim(data) #everything is right
# create a sum var, wxluding missing values
library(tidyverse)
library(dplyr)
#data$img_sum <- rowSums(select(data, imwbcnt, imbgeco, imueclt), na.rm = TRUE)
#head(data$img_avg)
#create mean var
data$img_avg <- rowMeans(select(data, imwbcnt, imbgeco, imueclt), na.rm = TRUE)
head(data$img_avg)
# select Finnish and Italian data
cntry_target <- c("EE", "LT", "LV")
data7 <- data %>% filter(cntry %in% cntry_target) %>%
select(., cntry, agea, gndr, img_avg, polintr, stflife)
data7 <- data7[complete.cases(data7[ ,c("cntry", "agea", "gndr", "img_avg", "polintr", "stflife")]), ]
summary(data7)
head(data7)
dim(data7) #looks right!
# histograms by groups for img_avg
ggplot(data7, aes(x = img_avg)) +
geom_histogram() + facet_grid(cntry ~ .)
data7 <- data7 %>%
mutate(img_avg_cat = cut(img_avg, breaks = c(0,2,4,6,8, Inf), labels = c("Allow many to come and live here","3-4", "5-6", "7-8", "Allow none")))
t1 <- table(data7$img_avg_cat, data7$stflife)
prop.table(t1) # sum of all values
prop.table(t1, 1) # sum of all values
corrmatrix <- cor(select(data7, img_avg, agea, gndr, polintr, stflife), use="complete.obs")
corrmatrix
library(corrplot)
corrplot(corrmatrix)
data7 <- data7 %>%
mutate(img_avg_cat = cut(img_avg, breaks = c(0,2,4,6,8, Inf), labels = c("Bad influence","3-4", "5-6", "7-8", "Good influence")))
t1 <- table(data7$img_avg_cat, data7$stflife)
prop.table(t1) # sum of all values
prop.table(t1, 1) # sum of all values
balloonplot(t(t1), main ="happiness and satisfaction", xlab ="", ylab="",
label = FALSE, show.margins = TRUE)
library(gplots)
balloonplot(t(t1), main ="happiness and satisfaction", xlab ="", ylab="",
label = FALSE, show.margins = TRUE)
mosaicplot(t1, shade = TRUE, las=2,
main = "happiness and satisfaction")
library(gplots)
balloonplot(t(t1), main ="happiness and satisfaction", xlab ="", ylab="",
label = FALSE, show.margins = TRUE)
mosaicplot(t1, shade = TRUE, las=2,
main = "happiness and satisfaction")
balloonplot(t(t1), main ="happiness and satisfaction", xlab ="effect of immigrants", ylab="satisfaction with life",
label = FALSE, show.margins = TRUE)
library(gplots)
balloonplot(t(t1), xlab ="effect of immigrants", ylab="satisfaction with life",
label = FALSE, show.margins = TRUE)
mosaicplot(t1, shade = TRUE, las=2,
main = "happiness and satisfaction")
library(gplots)
balloonplot(t(t1), main ="effect of immigrants and satisfaction with life",
label = T, show.margins = TRUE)
mosaicplot(t1, shade = TRUE, las=2,
main = "happiness and satisfaction")
data7 <- data7 %>%
mutate(stflife_cat = cut(stflife, breaks = c(0,2,4,6,8, Inf), labels = c("Extremely dissatisfied","3-4", "5-6", "7-8", "Extremely satisfied")))
t1 <- table(data7$img_avg_cat, data7$stflife_cat)
prop.table(t1, 1) # sum of all values
library(gplots)
balloonplot(t(t1), main ="effect of immigrants and satisfaction with life",
label = T, show.margins = TRUE)
mosaicplot(t1, shade = TRUE, las=2,
main = "happiness and satisfaction")
# set working directory
setwd("C:/R scripts/DWA2022")
#import data
library(haven) # to open csv
data <- read_sav("C:/R scripts/DWA2022/ESS9e03_1.sav")
head(data)
dim(data) #everything is right
# create a sum var, wxluding missing values
library(tidyverse)
library(dplyr)
#data$img_sum <- rowSums(select(data, imwbcnt, imbgeco, imueclt), na.rm = TRUE)
#head(data$img_avg)
#create mean var
data$img_avg <- rowMeans(select(data, imwbcnt, imbgeco, imueclt), na.rm = TRUE)
head(data$img_avg)
# select Finnish and Italian data
cntry_target <- c("EE", "LT", "LV")
data7 <- data %>% filter(cntry %in% cntry_target) %>%
select(., cntry, agea, gndr, img_avg, polintr, stflife)
data7 <- data7[complete.cases(data7[ ,c("cntry", "agea", "gndr", "img_avg", "polintr", "stflife")]), ]
summary(data7)
head(data7)
dim(data7) #looks right!
data7 %>% tabyl(img_avg, stlife, show_na=F) %>% chisq.test()
library(janitor)
library(janitor)
data7 %>% tabyl(img_avg, stlife, show_na=F) %>% chisq.test()
library(janitor)
data7 %>% tabyl(img_avg, stflife, show_na=F) %>% chisq.test()
library(janitor)
data7 %>% tabyl(img_avg, stflife, show_na=F) %>% chisq.test()
#print the results of x*2 test
results_chi1 <- chisq.test(data7$img_avg, data7$stflife)
results_chi1$observed
#print the results of x*2 test
results_chi1 <- chisq.test(data7$img_avg_cat, data7$stflife_cat)
data7 <- data7 %>%
mutate(img_avg_cat = cut(img_avg, breaks = c(0,2,4,6,8, Inf), labels = c("Bad influence","3-4", "5-6", "7-8", "Good influence")))
data7 <- data7 %>%
mutate(stflife_cat = cut(stflife, breaks = c(0,2,4,6,8, Inf), labels = c("Extremely dissatisfied","3-4", "5-6", "7-8", "Extremely satisfied")))
t1 <- table(data7$img_avg_cat, data7$stflife_cat)
prop.table(t1) # sum of all values
prop.table(t1, 1) # sum of all values
library(janitor)
data7 %>% tabyl(img_avg, stflife, show_na=F) %>% chisq.test()
#print the results of x*2 test
results_chi1 <- chisq.test(data7$img_avg_cat, data7$stflife_cat)
results_chi1$observed
library(janitor)
data7 %>% tabyl(img_avg, stflife, show_na=F) %>% chisq.test()
#print the results of x*2 test
results_chi1 <- chisq.test(data7$img_avg_cat, data7$stflife_cat)
results_chi1$observed
results_chi1$expected #estimated
results_chi1$residuals # The difference between observed and expected values
results_chi1$stdres #Standardized Residuals. The division of the difference of the observed and expected
library(janitor)
data7 %>% tabyl(img_avg, stflife, show_na=F) %>% chisq.test()
#print the results of x*2 test
results_chi1 <- chisq.test(data7$img_avg_cat, data7$stflife_cat)
results_chi1$observed
results_chi1$expected #estimated
results_chi1$residuals # The difference between observed and expected values
#testing for normal distribution
library(ggpubr)
ggqqplot(data7$img_avg)
img_avg_males <- data7  %>% filter(gndr == 1) %>% select(img_avg)
img_avg_females <- data7  %>% filter(gndr == 2) %>% select(img_avg)
img_avg_males <- as.numeric(unlist(img_avg_males))
img_avg_females <- as.numeric(unlist(img_avg_females))
# test first the equality of variances
var.test(img_avg ~ gndr, data = data7)
mean(img_avg_males)
# Computation of an unpaired two-samples t-test:
t.test(img_avg_males, img_avg_females, var.equal = TRUE)
#testing for normal distribution
library(dplyr)
library(rstatix)
data7 %>% group_by(cntry) %>% shapiro_test(img_avg)
# Statistical test of normality
# H0: variable is normally distributed, H1: variable is not normally distributed
shapiro.test(data7$img_avg)
ks.test(x = data7$img_avg, y = pnorm)
library(tidyverse)
library(ggpubr)
library(rstatix)
#H0: attitude to immigrants of young middel and old are equal
#H1: attitude to immigrants of young middel and old are different
pairwise.wilcox.test(data7$img_avg, data7$cntry, p.adjust.method = "bonferroni")
img_avg_males <- data7  %>% filter(gndr == 1) %>% select(img_avg)
img_avg_females <- data7  %>% filter(gndr == 2) %>% select(img_avg)
img_avg_males <- as.numeric(unlist(img_avg_males))
img_avg_females <- as.numeric(unlist(img_avg_females))
# test first the equality of variances
var.test(img_avg ~ gndr, data = data7)
# Computation of an unpaired two-samples t-test:
t.test(img_avg_males, img_avg_females, var.equal = TRUE)
#Mann-Whitney - test
wilcox.test(data7$img_avg ~ data7$gndr)
scatterplot(data7$img_avg ~ data7$stflife)
data7 %>%
ggplot(., aes(x = img_avg, y = stflife)) +
geom_point(position = "jitter") +
geom_smooth(method = lm)
data7 %>%
ggplot(., aes(x = img_avg, y = stflife)) +
geom_point() +
geom_smooth(method = lm)
data7 %>%
ggplot(., aes(x = img_avg, y = stflife)) +
geom_point()
data7 %>%
ggplot(., aes(x = img_avg, y = stflife)) +
geom_point() +
geom_smooth(method = lm)
data7 %>%
ggplot(., aes(x = img_avg, y = stflife)) +
geom_point(position = "jitter") +
geom_smooth(method = lm)
data7 %>%
ggplot(., aes(x = img_avg, y = stflife)) +
geom_point(position = "jitter") +
geom_smooth(method = lm)
data7 %>%
ggplot(., aes(x = img_avg, y = gndr)) +
geom_point(position = "jitter") +
geom_smooth(method = lm)
# A simple regression model
lm1 <- lm(img_avg ~ stflife, data = data7)
summary(lm1)
# Scatter plot with some jittering & regression line.
ggplot(ess_w6stf, aes(x = stflife, y = img_avg)) +
geom_point(position = "jitter") +
geom_smooth(method = lm)
# A simple regression model
lm1 <- lm(img_avg ~ stflife, data = data7)
summary(lm1)
# Scatter plot with some jittering & regression line.
ggplot(data7, aes(x = stflife, y = img_avg)) +
geom_point(position = "jitter") +
geom_smooth(method = lm)
# Diagnostic plots:
layout(matrix(c(1,2,3,4),2,2))
plot(lm1)
data7 %>%
ggplot(., aes(x = img_avg, y = stflife)) +
geom_point(position = "jitter") +
geom_smooth(method = lm)
lm1 <- lm(img_avg ~ stflife, plointr, agea, gndr, data = data7)
summary(lm1)
# A simple regression model
lm1 <- lm(img_avg ~ stflife, polintr, agea, gndr, data = data7)
data7
# A simple regression model
lm1 <- lm(img_avg ~ stflife, polintr, agea, gndr, data = data7)
# A simple regression model
lm1 <- lm(img_avg ~ stflife, polintr, agea, data = data7)
summary(lm1)
lm1 <- lm(img_avg ~ stflife, polintr, agea, data = data7)
summary(lm1)
lm1 <- lm(img_avg ~ polintr, agea, data = data7)
summary(lm1)
# A simple regression model
lm1 <- lm(img_avg ~ stflife + polintr + agea, data = data7)
summary(lm1)
lm1 <- lm(img_avg ~ stflife + polintr + agea +gndr, data = data7)
summary(lm1)
lm1 <- lm(img_avg ~ stflife + polintr  +gndr, data = data7)
summary(lm1)
# A simple regression model
lm1 <- lm(img_avg ~ stflife + polintr + agea, data = data7)
summary(lm1)
lm1 <- lm(img_avg ~ stflife + polintr + agea +gndr, data = data7)
summary(lm2)
lm1 <- lm(img_avg ~ stflife + polintr  +gndr, data = data7)
summary(lm3)
lm1 <- lm(img_avg ~ stflife + polintr, data = data7)
summary(lm4)
AIC(lm1)
BIC(lm1)
AIC(lm2)
BIC(lm2)
AIC(lm3)
BIC(lm3)
AIC(lm4)
BIC(lm4)
lm1 <- lm(img_avg ~ stflife + polintr + agea +gndr, data = data7)
summary(lm1)
lm1 <- lm(img_avg ~ stflife + polintr + agea, data = data7)
summary(lm2)
lm1 <- lm(img_avg ~ stflife + polintr  +gndr, data = data7)
summary(lm3)
lm1 <- lm(img_avg ~ stflife + polintr, data = data7)
summary(lm4)
AIC(lm1)
BIC(lm1)
AIC(lm2)
BIC(lm2)
AIC(lm3)
BIC(lm3)
AIC(lm4)
BIC(lm4)
summary(lm1)
# A simple regression model
lm1 <- lm(img_avg ~ stflife + polintr + agea +gndr, data = data7)
summary(lm1)
lm2 <- lm(img_avg ~ stflife + polintr + agea, data = data7)
summary(lm2)
lm3 <- lm(img_avg ~ stflife + polintr  +gndr, data = data7)
summary(lm3)
lm4 <- lm(img_avg ~ stflife + polintr, data = data7)
summary(lm4)
AIC(lm1)
BIC(lm1)
AIC(lm2)
BIC(lm2)
AIC(lm3)
BIC(lm3)
AIC(lm4)
BIC(lm4)
data7 %>%
ggplot(., aes(x = img_avg, y = plointr)) +
geom_point(position = "jitter") +
geom_smooth(method = lm)
data7 %>%
ggplot(., aes(x = img_avg, y = polintr)) +
geom_point(position = "jitter") +
geom_smooth(method = lm)
data7 %>%
ggplot(., aes(x = img_avg, y = agea)) +
geom_point(position = "jitter") +
geom_smooth(method = lm)
data7 %>%
ggplot(., aes(x = img_avg, y = gndr)) +
geom_point(position = "jitter") +
geom_smooth(method = lm)
s1<- data7 %>%
ggplot(., aes(x = img_avg, y = stflife)) +
geom_point(position = "jitter") +
geom_smooth(method = lm)
s2<-data7 %>%
ggplot(., aes(x = img_avg, y = polintr)) +
geom_point(position = "jitter") +
geom_smooth(method = lm)
s3<- data7 %>%
ggplot(., aes(x = img_avg, y = agea)) +
geom_point(position = "jitter") +
geom_smooth(method = lm)
s4<- data7 %>%
ggplot(., aes(x = img_avg, y = gndr)) +
geom_point(position = "jitter") +
geom_smooth(method = lm)
library(cowplot)
plot_grid(
s1, s2, s3, s4,
labels = c('1', '2', '3', '4'),
align="hv"
)
# diagnostic plots
layout(matrix(c(1,2,3,4),2,2)) # optional 4 graphs/page
plot(lm4)
img_avg_males <- data7  %>% filter(gndr == 1) %>% select(img_avg)
img_avg_females <- data7  %>% filter(gndr == 2) %>% select(img_avg)
img_avg_males <- as.numeric(unlist(img_avg_males))
img_avg_females <- as.numeric(unlist(img_avg_females))
# test first the equality of variances
var.test(img_avg ~ gndr, data = data7)
# Computation of an unpaired two-samples t-test:
t.test(img_avg_males, img_avg_females, var.equal = TRUE)
#Mann-Whitney - test
wilcox.test(data7$img_avg ~ data7$gndr)
s1<- data7 %>%
ggplot(., aes(x = img_avg, y = stflife)) +
geom_point(position = "jitter") +
geom_smooth(method = lm)
s2<-data7 %>%
ggplot(., aes(x = img_avg, y = polintr)) +
geom_point(position = "jitter") +
geom_smooth(method = lm)
s3<- data7 %>%
ggplot(., aes(x = img_avg, y = agea)) +
geom_point(position = "jitter") +
geom_smooth(method = lm)
s4<- data7 %>%
ggplot(., aes(x = img_avg, y = gndr)) +
geom_point(position = "jitter") +
geom_smooth(method = lm)
library(cowplot)
plot_grid(
s1, s2, s3, s4,
labels = c('1', '2', '3', '4'),
align="hv"
)
setwd("C:/R scripts/DWA2022")
library(haven)
# import data
data <- read_sav("C:/R scripts/DWA2022/ESS9e03_1.sav")
save(data,file="data.csv")
head(data)
dim(data)#everything is right
library(tidyverse)
library(sjlabelled)
get_labels(data$gndr) #to know labels for the categories
table(data$gndr) # there are 23020 males and 26499 females
# sub for males
males <- data %>% filter(gndr == 1) # 1 for males
table(males$gndr) #number in the table matches number of males that we got before
dim(males) # double check. Again number of observations is the same as number of males, so we successfully made the subsetting for males
females <- data %>% filter(gndr == 2) # 2 for females
table(females$gndr) # 26499
dim(females)
# Combine datasets
comb_data <- rbind(males, females) # df1 = males, df2 = females
table(comb_data$gndr)
#create two sets
set1 <- select(data, idno, cntry, gndr)
set2 <- select(data, idno, cntry, stflife)
head(set1) #all good
head(set2) #all good
# Merge
full_set <- merge(set1, set2, by = c("cntry", "idno"))
View(full_set) #success!
head(full_set)
table(data$agea)
table(data$gndr)
table(data$cntry)
table(data$stflife)
# aggregate by gender. Note: na.rm = TRUE
a1 <- data %>% group_by(gndr) %>%
summarise(n_stflife = n(), mean_stflife = mean(stflife, na.rm = TRUE)) #men are a bit more satisfied with life then women. But in average level of satisfaction is above average for man and for women.
a1
a2 <- data %>% group_by(gndr, cntry) %>%
summarise(n_stflife = n(), mean_stflife = mean(stflife, na.rm = TRUE))
head(a2) #print just first 2 pages to not make the report too large
a2[which(a2$mean_stflife == max(a2$mean_stflife)), ] #women in Denmark are the most satisfied with life
